// Firebase SDK を読み込む
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

// 🔹 Firebaseの設定
const firebaseConfig = {
  apiKey: "AIzaSyBYtkWuK0sbCYyQcVhLeFWCPhU7GhMG8pg",
  authDomain: "exceldisplay-505fc.firebaseapp.com",
  projectId: "exceldisplay-505fc",
  storageBucket: "exceldisplay-505fc.appspot.com",
  messagingSenderId: "491087347583",
  appId: "1:491087347583:web:64f812b63ad8b6ac0be44a",
  measurementId: "G-D5H647GG6L"
};

// 🔹 FirebaseアプリとFirestoreを初期化
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// 🔹 Handsontableの設定
const container = document.getElementById('table');
let hot;

// 🔹 Firestoreのデータを取得し、Handsontableの特定セルにセット
async function loadData() {
    const docRef = doc(db, "tables", "sheet1");  // 🔹 Firestoreのドキュメントを指定
    const docSnap = await getDoc(docRef);
    
    if (docSnap.exists()) {
        const data = docSnap.data();
        console.log("Firestore のデータ:", data);

        // 🔹 Handsontable に適用するデータ（デフォルト）
        let tableData = [
            ["名前", "年齢", "職業"],
            ["", "", ""]
        ];

        // 🔹 Firestore のデータを指定のセルに適用
        tableData[1][0] = data.name || "";  // 🔹 名前 → 1行目 0列目
        tableData[1][1] = data.age || "";   // 🔹 年齢 → 1行目 1列目
        tableData[1][2] = data.job || "";   // 🔹 職業 → 1行目 2列目

        return tableData;
    } else {
        console.warn("Firestore にデータが存在しません。");
        return [
            ["名前", "年齢", "職業"],
            ["", "", ""]
        ];
    }
}

// 🔹 Handsontable を初期化
loadData().then((data) => {
    hot = new Handsontable(container, {
        data: data,
        colHeaders: true,
        rowHeaders: true,
        width: "100%",
        height: "auto",
        manualColumnResize: true,
        manualRowResize: true,
        licenseKey: "non-commercial-and-evaluation"
    });
}).catch(error => {
    console.error("データの読み込みに失敗しました:", error);
});